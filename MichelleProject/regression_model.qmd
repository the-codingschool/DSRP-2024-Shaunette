```{r}
library(ggplot2)
library(caTools)
library(readr)
library(downloader)
library(caTools)
library(FNN)
library(readxl)

merged_data_clean <- readRDS("/Users/michelle/Downloads/DSRP/DSRP-2024-Shaunette/MichelleProject/merged_data_clean.rds")

power_relationship <- merged_data_clean %>%
  mutate(
    log_inspection_count = log(inspection_count),
    log_complaint_count = log(complaint_count),
    log_risk_1_count = log(risk_1_count),
    log_percent_aged_16_unemployed = log(percent_aged_16_unemployed),
    log_hardship_index = log(hardship_index)
  ) %>%
  select(
    log_inspection_count, log_complaint_count, log_risk_1_count, log_percent_aged_16_unemployed, log_hardship_index
  )
```

Splitting Data into test and train data

```{r}
split <- sample.split(power_relationship$log_inspection_count, SplitRatio = 0.8)
train_data <- subset(power_relationship, split == TRUE)
test_data <- subset(power_relationship, split == FALSE)
```

Creating Linear Models

```{r}
#Linear Model #1 - uses 2 predicting variables
lr_model <- lm(log_inspection_count ~ log_risk_1_count + log_complaint_count, data = train_data)

#Linear Model #2 - uses 4 predicting variables
extended_model <- lm(log_inspection_count ~ log_hardship_index + log_percent_aged_16_unemployed + log_risk_1_count + log_complaint_count, data = train_data)

```

```{r}
# predicting
pred <- predict(lr_model, newdata = test_data)
pred_2 <- predict(extended_model, newdata = test_data)
```

```{r}
# linear model 1
cat("mse = ", mean((test_data$log_inspection_count - pred)^2))
cat("\nr_squared = ", summary(lr_model)$r.squared)

# linear model 2
cat("\nmse = ", mean((test_data$log_inspection_count - pred_2)^2))
cat("\nr_squared = ", summary(extended_model)$r.squared)
```

```{r}
# anova test to compare models
anova_result <- anova(lr_model, extended_model)
print(anova_result)
```